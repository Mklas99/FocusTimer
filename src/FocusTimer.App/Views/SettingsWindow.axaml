<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:FocusTimer.App.ViewModels"
        mc:Ignorable="d"
        x:Class="FocusTimer.App.Views.SettingsWindow"
        x:DataType="vm:SettingsWindowViewModel"
        Title="FocusTimer – Settings"
        Width="640" Height="540"
        MinWidth="500" MinHeight="400"
        WindowStartupLocation="CenterOwner"
        CanResize="True"
        Background="{DynamicResource WidgetBackgroundBrush}"
        Foreground="{DynamicResource WidgetForegroundBrush}">

    <Design.DataContext>
        <vm:SettingsWindowViewModel />
    </Design.DataContext>

    <!-- Use our theme styles for section headers and labels -->
    <Window.Styles>
        <Style Selector="TextBlock.SectionHeader">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,12,0,8" />
            <Setter Property="Foreground" Value="{DynamicResource WidgetForegroundBrush}" />
        </Style>
        <Style Selector="TextBlock.SettingLabel">
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Margin" Value="0,0,8,0" />
            <Setter Property="Foreground" Value="{DynamicResource WidgetSecondaryForegroundBrush}" />
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="*,Auto" Margin="20">
        <!-- Settings Content -->
        <TabControl Grid.Row="0">
            <!-- General Tab -->
            <TabItem Header="General">
                <ScrollViewer>
                    <StackPanel Spacing="15">
                        <TextBlock Classes="SectionHeader" Text="Startup" />

                        <CheckBox IsChecked="{Binding Settings.AutoStartOnLogin}" Content="Start with Windows" />

                        <CheckBox IsChecked="{Binding Settings.StartMinimized}" Content="Start minimized to tray" />

                        <TextBlock Classes="SectionHeader" Text="Window" />

                        <CheckBox IsChecked="{Binding Settings.AlwaysOnTop}" Content="Keep widget always on top" />

                        <TextBlock Classes="SectionHeader" Text="Break Reminders" />

                        <CheckBox IsChecked="{Binding Settings.BreakRemindersEnabled}" Content="Enable break reminders" />

                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto" Margin="0,0,0,0">
                            <TextBlock Grid.Column="0" Classes="SettingLabel" Text="Remind every (minutes):" />
                            <NumericUpDown Grid.Column="1"
                                           Value="{Binding Settings.BreakIntervalMinutes}"
                                           Minimum="1"
                                           Maximum="240"
                                           Increment="5"
                                           Width="120"
                                           HorizontalAlignment="Left"
                                           IsEnabled="{Binding Settings.BreakRemindersEnabled}" />
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Logging Tab -->
            <TabItem Header="Logging">
                <ScrollViewer>
                    <StackPanel Spacing="15">
                        <TextBlock Classes="SectionHeader" Text="Log Location" />

                        <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,10">
                            <TextBox Grid.Column="0"
                                     Text="{Binding Settings.LogDirectory}"
                                     Watermark="Log directory path"
                                     IsReadOnly="True" />
                            <Button Grid.Column="1"
                                    Content="Browse…"
                                    Margin="5,0,0,0"
                                    Command="{Binding BrowseLogDirectoryCommand}"
                                    CommandParameter="{Binding $parent[Window]}" />
                        </Grid>

                        <TextBlock Classes="SectionHeader" Text="Data Retention" />

                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                            <TextBlock Grid.Column="0" Classes="SettingLabel" Text="Keep logs for (days):" />
                            <NumericUpDown Grid.Column="1"
                                           Value="{Binding Settings.DataRetentionDays}"
                                           Minimum="1"
                                           Maximum="3650"
                                           Increment="1"
                                           Width="120"
                                           HorizontalAlignment="Left" />
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Appearance Tab -->
            <TabItem Header="Appearance">
                <ScrollViewer>
                    <StackPanel Spacing="15">
                        <TextBlock Classes="SectionHeader" Text="Widget Opacity" />

                        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto">
                            <Slider Grid.Column="0"
                                    Value="{Binding Settings.WidgetOpacity}"
                                    Minimum="0.1"
                                    Maximum="1.0"
                                    TickFrequency="0.05"
                                    IsSnapToTickEnabled="True" />
                            <TextBlock Grid.Column="1"
                                       Text="{Binding Settings.WidgetOpacity, StringFormat='{}{0:P0}'}"
                                       Width="50"
                                       TextAlignment="Right"
                                       VerticalAlignment="Center"
                                       Margin="10,0,0,0" />
                        </Grid>

                        <TextBlock Classes="SectionHeader" Text="Widget Scale" />

                        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto">
                            <Slider Grid.Column="0"
                                    Value="{Binding Settings.WidgetScale}"
                                    Minimum="0.5"
                                    Maximum="3.0"
                                    TickFrequency="0.1"
                                    IsSnapToTickEnabled="True" />
                            <TextBlock Grid.Column="1"
                                       Text="{Binding Settings.WidgetScale, StringFormat='{}{0:F1}×'}"
                                       Width="50"
                                       TextAlignment="Right"
                                       VerticalAlignment="Center"
                                       Margin="10,0,0,0" />
                        </Grid>

                        <CheckBox IsChecked="{Binding Settings.UseCompactMode}"
                                  Content="Use compact mode"
                                  ToolTip.Tip="Switches the timer widget into a minimal mode" />

                        <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="{DynamicResource WidgetSecondaryForegroundBrush}" Text="Compact mode reduces the widget to a tiny bar with only the timer and play/pause button." />
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Hotkeys Tab -->
            <TabItem Header="Hotkeys">
                <ScrollViewer>
                    <StackPanel Spacing="15">
                        <TextBlock Classes="SectionHeader" Text="Global Hotkeys" />
                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource WidgetSecondaryForegroundBrush}"
                                   Margin="0,0,0,10"
                                   Text="Note: Hotkeys work system‑wide even when the app is not focused. Windows only." />

                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto">
                            <TextBlock Grid.Row="0" Grid.Column="0" Classes="SettingLabel" Text="Show/Hide Widget:" />
                            <TextBox Grid.Row="0" Grid.Column="1"
                                     Text="{Binding Settings.HotkeyShowHide}"
                                     Watermark="e.g. Ctrl+Alt+T"
                                     Width="200"
                                     HorizontalAlignment="Left"
                                     IsReadOnly="True"
                                     ToolTip.Tip="Default: Ctrl+Alt+T (editable hotkeys coming soon)" />

                            <TextBlock Grid.Row="1" Grid.Column="0" Classes="SettingLabel" Text="Toggle Timer:" Margin="0,10,0,0" />
                            <TextBox Grid.Row="1" Grid.Column="1"
                                     Text="{Binding Settings.HotkeyToggleTimer}"
                                     Watermark="e.g. Ctrl+Alt+P"
                                     Width="200"
                                     HorizontalAlignment="Left"
                                     IsReadOnly="True"
                                     ToolTip.Tip="Default: Ctrl+Alt+P (editable hotkeys coming soon)"
                                     Margin="0,10,0,0" />
                        </Grid>

                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource WidgetSecondaryForegroundBrush}" FontSize="11" Margin="0,10,0,0"
                                   Text="Tip: Hotkeys are registered when the app starts. Changes require restart." />
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Button Panel -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10" Margin="0,15,0,0">
            <Button Content="OK" Width="80" Command="{Binding OkCommand}" Click="OnOkClicked" />
            <Button Content="Apply" Width="80" Command="{Binding ApplyCommand}" />
            <Button Content="Cancel" Width="80" Command="{Binding CancelCommand}" CommandParameter="{Binding $parent[Window]}" />
        </StackPanel>
    </Grid>
</Window>