<UserControl xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="using:FocusTimer.App.Converters"
        xmlns:vm="using:FocusTimer.App.ViewModels"
        xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
        xmlns:views="clr-namespace:FocusTimer.App.Views"
        x:Class="FocusTimer.App.Views.TimerWidgetWindow"
        x:DataType="vm:TimerWidgetViewModel"
        Title="FocusTimer"
        WindowStartupLocation="Manual"
        SystemDecorations="None"
        ShowInTaskbar="False"
        TransparencyLevelHint="Transparent"
        CanResize="True"
        Background="Transparent"
        TransparencyBackgroundFallback="Pink"
        ExtendClientAreaToDecorationsHint="False"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="-1"
        BorderBrush="Transparent"
        BorderThickness="0"
        SizeToContent="Height"
        Width="300"
        Topmost="{Binding Settings.AlwaysOnTop}">

    <UserControl.Resources>
        <converters:PlayPauseConverter x:Key="PlayPauseConverter" />
        <converters:BooleanNegationConverter x:Key="BooleanNegationConverter" />
        <converters:BooleanToAngleConverter x:Key="BooleanToAngleConverter" />
    </UserControl.Resources>

    <UserControl.RenderTransform>
        <ScaleTransform ScaleX="{Binding Settings.WidgetScale}" ScaleY="{Binding Settings.WidgetScale}" />
    </UserControl.RenderTransform>
    
    <!-- Root container: keep window transparent, all visuals inside -->
    <Border Background="Transparent"
            CornerRadius="{DynamicResource WidgetCornerRadius}"
            Padding="{DynamicResource WidgetPadding}"
            RenderTransformOrigin="0.5,0.5">

        <Grid>
            <!-- Background layer -->
            <Border CornerRadius="{DynamicResource WidgetCornerRadius}"
                    Background="{Binding BackgroundBrush}"
                    Opacity="{Binding EffectiveBackgroundOpacity}" />


            <!-- Drag area fills available space -->
            <Border Grid.Column="0"
                Grid.RowSpan="2"
                x:Name="DragArea"
                Background="Transparent"
                BorderBrush="Transparent"
                BorderThickness="0"
                PointerPressed="WindowDragArea_PointerPressed"
                PointerEntered="DragArea_PointerEnter"
                PointerExited="DragArea_PointerLeave"
                Cursor="SizeAll" />
            <!-- Minimize button (top right) -->
            <Button Grid.Row="0"
                    Grid.Column="1"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Background="Transparent"
                    BorderBrush="Transparent"
                    BorderThickness="0"
                    Padding="0"
                    Width="16"
                    Height="16"
                    Margin="0"
                    Click="MinimizeButton_Click"
                    ToolTip.Tip="Minimize"
                    Opacity="{Binding EffectiveControlsOpacity}">
                <materialIcons:MaterialIcon Kind="WindowMinimize"
                                            Foreground="{DynamicResource SecondaryTextBrush}"
                                            Width="16"
                                            Height="10" />
            </Button>
            <!-- Content area: switch between full and compact modes -->
            <Grid Grid.Row="1">
                <views:FullModeView 
                    Margin="10,0,1,5"
                    IsVisible="{Binding Settings.UseCompactMode, Converter={StaticResource BooleanNegationConverter}}" />
                <!-- Margin: left=10, top=0, right=1, bottom=5 -->    
                <views:CompactModeView 
                    Margin="10,0,1,5"
                    IsVisible="{Binding Settings.UseCompactMode}" />
            </Grid>
        </Grid>
    </Border>
</UserControl>
